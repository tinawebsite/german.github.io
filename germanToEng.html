<!DOCTYPE html>
<html style="background-color:#fffb8c">
<head>
	<title>German to English</title>
</head>
<body>

	<header>

		<button style='border-radius:25px;color:#8003fc;background-color:#d9b3ff;outline-color:#8003fc' id="home">Home</button>
	</header>

	<script>
		//Setting Home button
		document.getElementById("home").addEventListener("click", function(){
			window.open("index.html", "_self")
		})
	</script>

	<h1 style="text-align:center;"><u>German to English</u></h1>

	<br>
	<section style="background-color:#fcce03" >
		<input type="radio" name="soundRadio" id="soundAndText" checked> Sound and text
		<input type="radio" name="soundRadio" id="text"> Only text
		<input type="radio" name="soundRadio" id="sound"> Only sound
	</section>

	
	<br>

	<section style="background-color:#ffda36">
		<input type="checkbox" id="allSelect" style="display:inline "> 
		<div style="display:inline">Select All</div> 
	</section>

	<br>

	<section id="listOfClasses" style="background-color:#ffda36"></section>

	<br>

	<div style="color:black;display:inline;"><u>Select the speed: </u></div><input type="range" min="25" max="200" value="75" id="speechSpeed">
	
	<br>
	<br>

	<button id="goButton" style='border-radius:25px;background-color:#fcce03;outline-color:#fcce03'>GO!</button>
	
	<br>

	<section id="deutscheSection" style="display:none">
		</h3><div><i>Type in the answer as a number, not a word.</i></div>
		<br>
		<div style="display:inline" id="scoreWord">Score: </div>
		<div id='counter' style="display:inline">0</div>
		<br>
		<br>
		<div id='germanWord' style="display:inline;"></div><div style="display:inline;"> </div><button id="soundButton" style="display:inline;border-radius:25px" onclick="playSound()"> üó£Ô∏è</button>
		<br> 
		<input style='display:block;'type='text' id='myInput' onkeydown = "if (event.keyCode == 13)document.getElementById('checkButton').click()">
		<button id='checkButton' style='border-radius:25px' onclick="checkUserAnswer()">CHECK</button>
		<button id='giveUpButton' style='border-radius:25px' onclick="giveUp()">GIVE UP</button>
		<button id='skipButton' style='border-radius:25px' onclick="skip(theseFiles, firstTime)">SKIP</button>
		<button id='nextButton' style='border-radius:25px' onclick="getWord(theseFiles, firstTime)">NEXT</button>
		<button id='endButton' style='border-radius:25px' onclick="end()">END</button>
		<button id='iWasCorrectButton' style='border-radius:25px;display:none' onclick="iWasCorrect(theseFiles, firstTime)">I WAS CORRECT</button>
		<div id='resultsLabel'></div>
	</section>	


	<script>
		var numOfLessons = 0

		function Lesson(num, json, title) {
 			this.num = num  			
  			this.json = json
  			this.title = title
		}
		
		var deutsche1 = new Lesson(1 ,"https://api.myjson.com/bins/houcp", "Numbers 0-19") ; numOfLessons++ 
		var deutsche2 = new Lesson(2, "https://api.myjson.com/bins/17f894", "Greetings") ; numOfLessons++ 
		var deutsche3 = new Lesson(3, "https://api.myjson.com/bins/luvl5", "Numbers 20-100") ; numOfLessons++ 
		var deutsche4 = new Lesson(4 ,"https://api.myjson.com/bins/avjp4", "Months") ; numOfLessons++ 	
		var deutsche5 = new Lesson(5 ,"https://api.myjson.com/bins/18xji0", "The Verb 'Sein'") ; numOfLessons++ 		
		var deutsche6 = new Lesson(6 ,"https://api.myjson.com/bins/lz5wp", "Dates") ; numOfLessons++ 	
		var deutsche7 = new Lesson(7, "https://api.myjson.com/bins/18zons", "The Verb 'Haben'") ; numOfLessons++ 	
		var deutsche8 = new Lesson(8 ,"https://api.myjson.com/bins/fvsw8", "Countries") ; numOfLessons++	
		var deutsche9 = new Lesson(9 ,"https://api.myjson.com/bins/vibcw", "School Subjects") ; numOfLessons++	
		var deutsche10 = new Lesson(10 ,"https://api.myjson.com/bins/bypcc", "Opinions") ; numOfLessons++	
		var deutsche11 = new Lesson(11 ,"https://api.myjson.com/bins/9im1o", "Adjectives for Opinions") ; numOfLessons++	
		var deutsche12 = new Lesson(12 ,"https://api.myjson.com/bins/1gibn0", "Days of the Week") ; numOfLessons++	
		var deutsche13 = new Lesson(13 ,"https://api.myjson.com/bins/85za6", "Food and Drink") ; numOfLessons++	
		var deutsche14 = new Lesson(14 ,"https://api.myjson.com/bins/8tk1q", "The verbs 'Essen' and 'Trinken'") ; numOfLessons++	
		var deutsche15 = new Lesson(15 ,"https://api.myjson.com/bins/15t9ri", "Food Adjectives") ; numOfLessons++	
		var deutsche16 = new Lesson(16 ,"https://api.myjson.com/bins/18bai6", "Clothes") ; numOfLessons++	

		window.localStorage.setItem("numOfLessons",  numOfLessons)

		var mySection = document.getElementById("listOfClasses")

		//Creating the checkboxes
		for (var i = 1; i <= numOfLessons; i++) {
    		var title = eval("deutsche" + i)

		 	var checkbox = document.createElement("input")
		 	checkbox.type = "checkbox"
		 	checkbox.id = "checkbox" + i
		 	checkbox.style.display= "inline"
		  	mySection.appendChild(checkbox)

		  	var lessonTitle = document.createElement("div")
		 	lessonTitle.id = "lessonTitle" + i
		 	lessonTitle.style.display = "inline"
		 	lessonTitle.innerHTML = title.title
		  	mySection.appendChild(lessonTitle)	  	

		  	var br = document.createElement("br")
		  	mySection.appendChild(br)
		}
	</script>

	
	<script>
	    var deutsche1Dictionary = {} 
		
		fetch(deutsche1.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche1Dictionary[key] = myJson[key]})})	    

	    var deutsche2Dictionary = {}

	    fetch(deutsche2.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche2Dictionary[key] = myJson[key]})})	    

	    var deutsche3Dictionary = {}

	    fetch(deutsche3.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche3Dictionary[key] = myJson[key]})})

	   	var deutsche4Dictionary = {}

	   	fetch(deutsche4.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche4Dictionary[key] = myJson[key]})})

	   	var deutsche5Dictionary = {}

	   	fetch(deutsche5.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche5Dictionary[key] = myJson[key]})})

	   	var deutsche6Dictionary = {}

	   	fetch(deutsche6.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche6Dictionary[key] = myJson[key]})})

	   	var deutsche7Dictionary = {}

	   	fetch(deutsche7.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche7Dictionary[key] = myJson[key]})})

	   	var deutsche8Dictionary = {}

	   	fetch(deutsche8.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche8Dictionary[key] = myJson[key]})})	   

	   	var deutsche9Dictionary = {}

	   	fetch(deutsche9.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche9Dictionary[key] = myJson[key]})})	   	
	   	
	   	var deutsche10Dictionary = {}

	   	fetch(deutsche10.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche10Dictionary[key] = myJson[key]})})	   
	   	
	   	var deutsche11Dictionary = {}

	   	fetch(deutsche11.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche11Dictionary[key] = myJson[key]})})	   	
	   	
	   	var deutsche12Dictionary = {}

	   	fetch(deutsche12.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche12Dictionary[key] = myJson[key]})})

	   	var deutsche13Dictionary = {}

	   	fetch(deutsche13.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche13Dictionary[key] = myJson[key]})})

	   	var deutsche14Dictionary = {}

	   	fetch(deutsche14.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche14Dictionary[key] = myJson[key]})})

	   	var deutsche15Dictionary = {}

	   	fetch(deutsche15.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche15Dictionary[key] = myJson[key]})})

	   	var deutsche16Dictionary = {}

	   	fetch(deutsche16.json).then(function(response){return response.json()}).then(function(myJson){Object.keys(myJson).forEach(function(key){deutsche16Dictionary[key] = myJson[key]})})

	   	var theseFiles = {}
		var numOfLessons = window.localStorage.getItem("numOfLessons")
		var checkedFiles = []
		var questionsAnswered = 0
		var firstTime = true

		document.getElementById("allSelect").addEventListener("change", function(){
			if(this.checked == true){
				for(var i = 1; i <= numOfLessons; i++){
					document.getElementById("checkbox" + i).checked = true
				}
			}else{
				for(var i = 1; i <= numOfLessons; i++){
					document.getElementById("checkbox" + i).checked = false
				}
			}
		})

		document.getElementById("goButton").addEventListener( "click", function(){
			var firstTime = true
			theseFiles = {}
			checkedFiles = []
			for(var i = 1; i <= numOfLessons; i++){
				if(document.getElementById("checkbox" + i).checked == true){
					var x = i
					checkedFiles.push(parseInt(x))
					document.getElementById("deutscheSection").style.display = "block"
					for(i in checkedFiles){
						var x = checkedFiles[i]
						theseFiles = Object.assign(theseFiles, eval("deutsche" + x + "Dictionary"))
					}
				}
			}
			window.localStorage.setItem("theseFiles", theseFiles)
			getWord(theseFiles, firstTime)
		})

		
		function getWord(dictionary, firstTime){
			if(firstTime == true){
				var deletingDictionary = dictionary
				var firstTime = false
			}

			if(document.getElementById("sound").checked == true){
				var sound = true
				var text = false
			}else if(document.getElementById("text").checked == true){
				var sound = false
				var text = true
			}else{
				var sound = true
				var text = true
			}

			if(sound == true){
				document.getElementById("soundButton").style.display = "inline"
			}else{
				document.getElementById("soundButton").style.display = "none"
			}
			var dictionary = dictionary
			var thisCounter = parseInt(document.getElementById("counter").innerHTML)
			isWrong = false
			var listOfValsUnchanged = []
			for (var key in dictionary) {
		    	if (dictionary.hasOwnProperty(key)) {
		        	listOfValsUnchanged.push([key])
		    	}
			}

			var numOfKeysUnchanged = (Object.keys(listOfValsUnchanged)).length


			document.getElementById("scoreWord").style.display = "inline"
			document.getElementById("counter").style.display = "inline"

			document.getElementById("myInput").value = ""
			document.getElementById("resultsLabel").innerHTML = ""
			document.getElementById("nextButton").style.display = "none"
			document.getElementById("skipButton").style.display = "inline"
			document.getElementById("endButton").style.display = "inline"
			document.getElementById("iWasCorrectButton").style.display = "none"
			document.getElementById("checkButton").style.display = "inline"
			document.getElementById("giveUpButton").style.display = "inline"

			var listOfVals = []
			for (var key in deletingDictionary) {
			    if (deletingDictionary.hasOwnProperty(key)) {
			        listOfVals.push([key])
			    }
			}

			var numOfKeys = (Object.keys(listOfVals)).length
			var randomNumber = Math.floor((Math.random() * numOfKeys))
			window.localStorage.setItem("thisCounter", thisCounter)
			window.localStorage.setItem("questionsAnswered", questionsAnswered)

			if(deletingDictionary[listOfVals[randomNumber]] == undefined){
				end()
				}else {		
					if(text == true){		
						document.getElementById("germanWord").innerHTML = deletingDictionary[listOfVals[randomNumber]]
						}			
						var correctAns = listOfVals[randomNumber]
						window.localStorage.setItem("correctAns",  correctAns)
						window.localStorage.setItem("readThisWord",  deletingDictionary[listOfVals[randomNumber]])
						delete deletingDictionary[listOfVals[randomNumber]]
			}		

			window.localStorage.setItem("sound", sound)
			playSound()
		}

		function giveUp(){
			var thisCounter = parseInt(document.getElementById("counter").innerHTML)
			document.getElementById("resultsLabel").innerHTML = "The correct answer was: " + window.localStorage.getItem("correctAns")
			document.getElementById("resultsLabel").style = "color:red"
			document.getElementById("counter").innerHTML =  thisCounter
			document.getElementById("skipButton").style.display = "none"
			document.getElementById("checkButton").style.display = "none"
			document.getElementById("giveUpButton").style.display = "none"
			document.getElementById("nextButton").style.display = "inline"
			isWrong = true
			var msg = new SpeechSynthesisUtterance("The correct answer was " + window.localStorage.getItem("correctAns"))
			msg.rate = document.getElementById("speechSpeed").value	/ 100	
			msg.lang = "en"
			window.speechSynthesis.speak(msg)
			questionsAnswered = questionsAnswered + 1
		}

		function checkUserAnswer(){
			questionsAnswered = questionsAnswered + 1
			var thisCounter = parseInt(document.getElementById("counter").innerHTML)
			var correctAns = window.localStorage.getItem("correctAns")
			var correct1 = correctAns.toLowerCase()
			var userAns = document.getElementById("myInput").value
			var user1 = userAns.toLowerCase()

			if(correct1 == user1){
				document.getElementById("resultsLabel").innerHTML = "Well Done"
				document.getElementById("resultsLabel").style = "color:green"
				document.getElementById("nextButton").style.display = "inline"
				if(isWrong == false){
					thisCounter = thisCounter + 1
				}
				document.getElementById("counter").innerHTML = thisCounter
				document.getElementById("skipButton").style.display = "none"
				document.getElementById("checkButton").style.display = "none"
				document.getElementById("giveUpButton").style.display = "none"
				isWrong = true
				var msg = new SpeechSynthesisUtterance("Well Done!")

			}else{
				document.getElementById("resultsLabel").innerHTML = "Try Again"
				document.getElementById("resultsLabel").style = "color:red"
				document.getElementById("iWasCorrectButton").style.display = "inline"
				document.getElementById("counter").innerHTML = thisCounter
				isWrong = true
				var msg = new SpeechSynthesisUtterance("Try Again!")
			}
			msg.rate = document.getElementById("speechSpeed").value	/ 100	
			msg.lang = "en"
			window.speechSynthesis.speak(msg)
		}

		function skip(dictionary, firstTime){
			getWord(dictionary, firstTime)
		}

		function iWasCorrect (dictionary, firstTime){
			var thisCounter = window.localStorage.getItem("thisCounter")
			var thisCounter = parseInt(thisCounter) + 1
			document.getElementById("counter").innerHTML = thisCounter
			getWord(dictionary, firstTime)
		}
		
	    function playSound() {
	    	var sound = window.localStorage.getItem("sound")
	    	var readThisWord = window.localStorage.getItem("readThisWord")
	    	if(sound = true){
				var msg = new SpeechSynthesisUtterance(JSON.stringify(readThisWord))
				msg.lang = "de"
				msg.rate = document.getElementById("speechSpeed").value	/ 100	
				window.speechSynthesis.speak(msg)
	    	}
	    }

	    function end(){
	    	var thisCounter = window.localStorage.getItem("thisCounter")
	    	var questionsAnswered = window.localStorage.getItem("questionsAnswered")

	    	if(questionsAnswered == 0){
	    		var message = "You have not gotten any questions correct."
	    		document.getElementById("resultsLabel").innnerHTML = message
	    	} else {
		    	eval("endScore =" + thisCounter/questionsAnswered*100)
				var message = ""
				if(eval("endScore") == 100){
					var message = "Perfect! You got all the questions right!"
				} else if (eval("endScore")> 50){
					var message = "Well done! You got the majority of the questions correct."
				} else if (eval("endScore") >= 10){
					var message = "Keep learning the words and practising them, you didn't do very well."
				}else if(eval("endScore") < 30){
					var message = "Keep practising. You didn't get many questions correct."
				}

				document.getElementById("resultsLabel").innerHTML = "You have finished, you got " + eval("endScore").toFixed(1) + "% of questions correct." + " " +  message	
	    	}

			document.getElementById("resultsLabel").style.color = "black"
			document.getElementById("germanWord").innerHTML = ""
			document.getElementById("soundButton").style.display = "none"
			document.getElementById("myInput").value = ""
			document.getElementById("nextButton").style.display = "none"
			document.getElementById("endButton").style.display = "none"
			document.getElementById("skipButton").style.display = "none"
			document.getElementById("checkButton").style.display = "none"
			document.getElementById("giveUpButton").style.display = "none"
			document.getElementById("scoreWord").style.display = "none"
			document.getElementById("counter").style.display = "none"

			var msg = new SpeechSynthesisUtterance(document.getElementById("resultsLabel").innerHTML)
			msg.lang = "en"
			msg.rate = document.getElementById("speechSpeed").value	/ 100	
			window.speechSynthesis.speak(msg)
	    }
	</script>
</body>
</html>